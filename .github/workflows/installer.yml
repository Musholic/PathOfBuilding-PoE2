name: Create new installer
on:
  release:
    types: [published]
  workflow_dispatch:
env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
jobs:
  release:
    runs-on: windows-latest
    steps:
            - name: Checkout
              uses: actions/checkout@v3
              with:
                repository: 'PathOfBuildingCommunity/PathOfBuilding-Installer'
                ref: 'master'
                ssh-key: '${{ secrets.POB_INSTALLER_KEY }}'
            - name: Install NSIS
              run: |
                choco install nsis --yes
                echo "C:\Program Files (x86)\NSIS" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append
            - name: Check NSIS
              run: makensis /VERSION
            - name: Create installer
              run: 'python3 make_release.py --game-version 2'
            - name: Upload artifact
              run: >
                gh release upload ${{ github.event.release.tag_name }} (Get-ChildItem Dist -File).FullName --clobber -R ${{ github.repository }};

